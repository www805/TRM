<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" >
<head>
    <meta charset="UTF-8">
    <title  th:text="${getRecordByIdModel.title}">智能提讯系统</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/uimaker/css/common.css">
</head>
<style>
    .layui-card{
        box-shadow: 0 0px 0px 0 rgba(0,0,0,.05);
    }
    .layui-card-header{
        background-color: #E5F4FD;
        border: 2px solid #FFFFFF;
        font-weight: bold;
    }

    html{
        background-color: #FFFFFF;
    }
    .font_red_color{
        color: red;
    }
    .font_blue_color{
        color: #1171d6;
    }
    .layui-col-md9 td{
        text-align: left;
    }
    .atalk{
        margin:10px;
    }
    .atalk p{
        color: #999;
    }
    .atalk span{
        display:inline-block;
        background:#0181cc;
        border-radius:10px;
        color:#fff;
        padding:5px 10px;
        word-wrap:break-word;
        margin-top: 5px;
    }
    .btalk{
        margin:10px;
        text-align:right;
    }
    .btalk p{
        color: #999;
    }
    .btalk span{
        display:inline-block;
        background:#ef8201;
        border-radius:10px;
        color:#fff;
        padding:5px 10px;
        word-wrap:break-word;
        /*text-align: left;*/
        margin-top: 5px;
    }
    table td {
        text-align: left;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
    #casehtml .layui-table td{
        word-break: break-all;/*必须*/
        white-space: normal;
        text-align: left;
    }

    .highlight_left{
     color: #FFFF00 !important ;text-shadow: black 0.1em 0.1em 0.2em;font-weight: bold;
    }

    .highlight_right{
        color: #bfff00 !important ;text-shadow: black 0.1em 0.1em 0.2em;font-weight: bold;
    }

    .highlight_all{
        color: #156b4b !important ;font-weight: bold;
        background-color: #FFFF00;
    }
    .highlight_dq{
        color: rgba(34, 214, 61, 0.85) !important ;font-weight: bold;
        background-color: #FFFF00;
    }

    @-webkit-keyframes fade{	/*透明度由0到1*/
        0%{ color: #FFFFFF; background-color: red;}
        100%{ background-color:transparent;}
    }
    .highlight_monitorall {
        -webkit-animation: fade 1s infinite ease-in-out;
    }
    ::-webkit-scrollbar {
        width: 0px;
    }

    #videos::-webkit-scrollbar
    {
        width: 8px;
        height: 8px;
        background-color: #F5F5F5;
    }

    /*定义滚动条轨道 内阴影+圆角*/
    #videos::-webkit-scrollbar-track
    {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
        border-radius: 10px;
        background-color: #F5F5F5;
    }

    /*定义滑块 内阴影+圆角*/
    #videos::-webkit-scrollbar-thumb
    {
        border-radius: 10px;
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
        background-color: rgba(100, 100, 100, 0.7);
    }
    .layui-btn+.layui-btn {
        margin-left: 0px;
    }

    #recorddetail_scrollhtml{
        width:100%; height: 650px; overflow-x: hidden; overflow-y: hidden;padding-right: 10px;
    }

    #recorddetail_scrollhtml:hover{
        overflow-y: scroll;
    }

    #recorddetail_scrollhtml::-webkit-scrollbar
    {
        width: 8px;
        height: 8px;
        background-color: #F5F5F5;
    }
    #recorddetail_scrollhtml::-webkit-scrollbar-thumb
    {
        border-radius: 10px;
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.25);
        background-color: rgba(203, 203, 203, 0.1);
    }



    .table_td_tt{padding: 7px 7px 7px 15px;white-space: normal;border-bottom: 1px solid #CCCCCC;outline: none;}
    .table_td_tt label{padding: 0px;white-space: normal;outline: none;font-size: 16px;vertical-align:middle;}
    .table_td_tt span{padding: 0px;white-space: normal;outline: none;font-size: 16px;}


    label[name='w']:empty:before{
        content: attr(placeholder);
        color:#CCCCCC;
    }
    label[name='w']:focus:before{
        content:none;
    }

    label[name='q']:empty:before{
        content: attr(placeholder);
        color:#CCCCCC;
    }
    label[name='q']:focus:before{
        content:none;
    }
    #btnadd{
        text-align: center;
    }
    .layui-form-switch{
        margin-top: 8px;
    }
   /* #recorddetail{
        cursor:text
    }*/
</style>
<body>
<div class=" layadmin-message-fluid" style="margin: 20px;">
    <div th:replace="header :: header">...</div>

    <div class="layui-elem-quote layui-row" style=" padding: 10px;">
        <div class="layui-col-md8">
            <h3 th:text="${getRecordByIdModel.title}">智能提讯系统</h3>
        </div>
        <div class="layui-col-md4" style="display: none" id="gZIPVod_html">
            <div class="layui-col-md3" style="text-align: right">进度：</div>
            <div class="layui-col-md9">
                <div class="layui-progress  " lay-showPercent="true" style="margin:8px" >
                    <div class="layui-progress-bar" lay-percent="0%"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-row layui-form " >
            <div class="layui-col-md3 " style="height: 810px;border:1px  solid #F2F2F2; overflow-x: hidden; overflow-y: scroll;" >
                <div class="layui-card">
                    <div class="layui-card-header" style="white-space: nowrap;text-overflow: ellipsis; overflow: hidden;"  >
                        当前笔录：<span id="recordtitle">笔录标题</span>
                       <!-- <a class="layui-a-tips" onclick="opneModal_1();">切换笔录</a>-->
                    </div>
                </div>
                <div >
                    <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                        <ul class="layui-tab-title">
                            <li class="layui-this">案件信息<i class="layui-icon layui-icon-edit" style="font-size: 20px;color: red;visibility: hidden" title="编辑" id="open_casetouser" onclick="open_casetouser()"></i></li>
                            <li id="asr_html" style="display: none">语音识别<span id="webkit2"></span></li><!--onclick="getRecord();"-->
                            <li id="mood_html" style="display: none">情绪报告</li>
                        </ul>
                        <div class="layui-tab-content" >
                            <div class="layui-tab-item layui-show" id="casehtml">
                                <div class="layui-card">
                                 <!--   <div class="layui-card-header">案件信息</div>-->
                                    <div style="height: 640px; overflow-x: hidden; overflow-y: scroll; " >
                                        <div class="layui-card-body">
                                                <table class="layui-table" lay-skin="line" style="table-layout: fixed" >
                                                   <tbody id="caseAndUserInfo_html">
                                                       <tr>
                                                           <td style="width: 30%">案件名称</td>
                                                           <td></td>
                                                       </tr>
                                                       <tr>
                                                           <td>被询(讯)问人</td>
                                                           <td></td>
                                                       </tr>
                                                       <tr>
                                                           <td>当前案由</td>
                                                           <td></td>
                                                       </tr>
                                                       <tr>
                                                           <td>案件时间</td>
                                                           <td></td>
                                                       </tr>
                                                       <tr>
                                                           <td>案件编号</td>
                                                           <td></td>
                                                       </tr>
                                                   </tbody>
                                                </table>
                                         </div>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-tab-item" id="record_hoverhtml">
                                <div class="layui-card-header" style="font-weight: normal;background-color: transparent;overflow: hidden;line-height: normal;display: none;height: initial" id="recordreals_selecthtml">
                                    <div class="layui-col-md12 layui-col-xs12  layui-col-lg12" style="margin-bottom: 10px;display: none" id="generatePhreport">
                                        <input type="checkbox" name="phreportshowhide" id="phreportshowhide" lay-skin="switch" lay-text="开启|关闭" lay-filter="phreportshowhide">
                                        <span style="float: right"><span style="color: red" id="phreportshowhidemsg">（提示:开启可勾选生成情绪报告)</span>
                                        <button type="button" class="layui-btn layui-btn-normal" id="uploadPhreport" onclick="uploadPhreport();" style="visibility: hidden">生成情绪报告</button>
                                        </span>
                                    </div>
                                    <div class="layui-col-md12 layui-col-xs12  layui-col-lg12" >
                                        <div class="layui-col-md7 layui-col-xs7 layui-col-lg7" >
                                            <input type="text" name="recordreals_select" lay-verify="required" placeholder="搜索内容" autocomplete="off" class="layui-input" id="recordreals_select" oninput="recordreals_select();" >
                                        </div>
                                        <div class="layui-col-md5 layui-col-xs5  layui-col-lg5 layui-btn-group" >
                                            <button type="button" class="layui-btn layui-btn-normal" onclick="last_realtxt();" >
                                                <i class="layui-icon">&#xe619;</i>
                                            </button>
                                            <button type="button" class="layui-btn layui-btn-normal "onclick="next_realtxt();">
                                                <i class="layui-icon">&#xe61a;</i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-card">
                                    <!--<div class="layui-card-header">笔录实时回访</div>-->
                                    <div style="height:590px; overflow-x: hidden; overflow-y: scroll;" id="recordreals_scrollhtml">
                                        <div class="layui-card-body" >
                                            <div class="talk_show"  id="recordreals">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                           <div class="layui-tab-item" id="moodhtml">
                               <form class="layui-form" >
                                   <div class="layui-form-item">
                                       <label class="layui-form-label" style="width: auto;">报告名</label>
                                       <div class="layui-input-inline">
                                           <input type="text" name="phreportname" id="phreportname" lay-verify="required" placeholder="请输入情绪报告名称" autocomplete="off" class="layui-input" oninput="getPhreportsByParam();" >
                                       </div>
                                       <!--空间小-->
                                     <!--  <label class="layui-form-label" style="width: auto;">创建时间</label>
                                       <div class="layui-input-inline" style="width: 300px;">
                                           <input type="text" name="starttime" id="starttime" lay-verify="required" placeholder="请输入创建时间" autocomplete="off" class="layui-input" >
                                       </div>-->
                                       <input type="button" class="layui-btn layui-btn-normal " onclick="getPhreportsByParam();" value="查询"/>
                                   </div>
                               </form>
                               <div th:replace="page :: page">...</div>
                           </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="layui-col-md9"  style="height: 810px;border:1px  solid #F2F2F2; overflow-x: hidden; overflow-y: scroll;" >
                        <button class="layui-btn layui-btn-normal " onclick="javascript:window.history.go(-1);return false;">返回上一页</button>
                        <div class="layui-inline" style="margin-bottom:0">
                            <div class="layui-unselect layui-form-select" name="btn_div"   showorhide="false">
                                <div class="layui-select-title">
                                    <button type="button"  value="" readonly="" class="layui-btn layui-btn-normal" onclick="btn(this);"><i class="layui-icon" >&#xe601;</i>  导出</button>
                                </div>
                                <dl class="layui-anim layui-anim-upbit" >
                                    <dd lay-value="" class="" onclick="exportWord(this);">导出word</dd>
                                    <dd lay-value="" class="" onclick="exportPdf(this);">导出pdf</dd>
                                </dl>
                            </div>
                        </div>
                        <button class="layui-btn layui-btn-normal" onclick="gZIPVod();" title="打包下载">
                            <i class="layui-icon" >&#xe601;</i>打包下载
                        </button>
                   <div class="layui-inline" style="float: right">
                        <label class="layui-form-label" style="width: 100px">当前定位差值：</label>
                        <div class="layui-input-inline" style="width: 80px;">
                            <input type="number" name="positiontime"  id="positiontime"  readonly  title="点击可修改" autocomplete="off" class="layui-input" onclick="open_positiontime()">
                        </div>
                    </div>
                    <div class="layui-card">
                        <div class="layui-card-header">笔录回放 <span style="color: red">（提示:<span class="highlight_left">黄色</span>高亮跟随视频定位，<span class="highlight_right">绿色</span>高亮跟随双击定位）</span>
                        </div>
                        <div class="layui-card-body">
                            <!--视频点播区域-->
                            <div class="layui-row" style="">
                                <div class="layui-col-md5" id="fd_ph_HTML"  >
                                    <div style="height: 730px; overflow-x: hidden; overflow-y: scroll;">
                                        <div class="layui-col-md12" id="fd_HTML">
                                            <div class="layui-col-md12">
                                              <div th:replace="video :: video"   >...</div>
                                            </div>
                                            <div class="layui-col-md12" style="line-height: 50px">
                                                <div style="width: 95%">
                                                    <!--<button type="button" id="goleft" class="layui-btn layui-btn-sm layui-btn-primary" style="float: left;"><i class="layui-icon layui-icon-left"></i></button>-->
                                                    <div style="overflow-x: auto;overflow-y: hidden;white-space: nowrap;width:100%;margin:5px;" id="videos">
                                                    </div>
                                                    <!--<button type="button" id="goright"  class="layui-btn layui-btn-sm layui-btn-primary" style="float: right;"><i class="layui-icon layui-icon-right"></i></button>-->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-md12"id="ph_HTML" style="display: none">
                                            <div class="layui-col-md12" >
                                                <div id="showmsg" style=" margin: 2px 0px 2px 0px;border-radius: 4px;border: 1px solid transparent;height:32px;line-height: 32px;color: #31708f; background-color: #d9edf7; border-color: #bce8f1;text-align: center" ><strong>身心回放加载中...</strong></div>
                                            </div>
                                            <div class="layui-col-md12" >
                                                <div id="main1" style="height:180px;width:100%;"></div>
                                            </div>
                                            <div class="layui-col-md12 layui-form-item" style="margin-top: 10px" >
                                                <div  id="monitor_btn" style="display:inline">
                                                    <span class="layui-badge layui-btn" isn="1"  type='stress'  onclick="select_monitor(this);">紧张值</span>
                                                    <span class="layui-badge layui-bg-gray layui-btn" isn="-1" type='hr' onclick="select_monitor(this);">心率</span>
                                                    <span class="layui-badge layui-bg-gray layui-btn" isn="-1"  type='spo2'  onclick="select_monitor(this);">血氧</span>
                                                    <span class="layui-badge layui-bg-gray layui-btn" isn="-1" type='hrv'  onclick="select_monitor(this);">心率变异</span>
                                                    <span class="layui-badge layui-bg-gray layui-btn" isn="-1"  type='bp'  onclick="select_monitor(this);">血压变化</span>
                                                    <span class="layui-badge layui-bg-gray layui-btn" isn="-1" type='br'  onclick="select_monitor(this);">呼吸次数</span>
                                                    <span class="layui-badge layui-bg-gray layui-btn" isn="-1"  type='relax'  onclick="select_monitor(this);">放松值</span>
                                                </div>
                                                <span class="layui-badge layui-bg-blue layui-btn" isn="-1"  type='all'  onclick="select_monitorall(this);">查看全部</span>
                                                <span class="layui-badge layui-bg-black layui-btn" isn="-1"  type='allranking'  onclick="select_monitorallranking(this);">排行榜</span>
                                                <div style="width:96.5%;text-align: center;margin-top: 2px;color:#1171d6"><span class="layui-badge layui-bg-black"  style="width: 100%;" id="snrtext">fps：0&nbsp;hr_snr：0&nbsp;stress_snr：0</span></div>
                                                <div style="width:96.5%;text-align: center;margin-top: 2px;color:#1171d6">
                                                <span class="layui-badge-rim"  style="width: 100%;" id="monitoralltext">
                                                    生理状态： 加载中
                                                    <span  id="monitorall_stress">紧张值： 0</span>
                                                    <span  id="monitorall_hr">心率： 0</span>
                                                     <span  id="monitorall_spo2">血氧： 0</span>
                                                    <span  id="monitorall_hrv">心率变异： 0</span>
                                                     <span  id="monitorall_bp">血压变化： 0</span>
                                                    <span  id="monitorall_br">呼吸次数： 0</span>
                                                    <span  id="monitorall_relax">放松值： 0</span>
                                                 </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-md7" id="record_qw_HTML" >
                                    <div class="layui-card">
                                        <div class="layui-col-md12">
                                            <div class="layui-col-md3">
                                                <strong id="recorddetail_strong"></strong>
                                            </div>
                                            <div class="layui-col-md9">
                                                <div style="float: right;display: none" id="wqutil">
                                                    <button class="layui-btn layui-btn-warm" onclick="focuslable(null,2,'q');" >添加自定义问答</button>
                                                    <button class="layui-btn layui-btn-normal"  id="baocun" >保存</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="recorddetail_webkit">
                                            <div style="" id="recorddetail_scrollhtml">
                                                <div class="layui-card-body">
                                                    <div class="layui-col-md12  layui-show" style="height: 300px">
                                                        <iframe src=""  frameborder="0" class="layui-iframe"  id="wordheaddownurl" name="wordheaddownurl" style="height: 100%;width: 100%"></iframe>
                                                    </div>
                                                    <table class="layui-table"  lay-skin="nob" style="table-layout: fixed;margin-bottom: 10px; ">
                                                        <tbody id="recorddetail">

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


            </div>
    </div>
    <div th:replace="footer :: footer">...</div>
</div>

<script id="pagelisttemplates" type="text/html">

    <table class="layui-table" style="table-layout: fixed" >
        <thead>
        <tr>
            <th style="width: 60px" >序号</th>
            <th>名称</th>
            <th>创建时间</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody id="pagelisttemplates_tbody">
        {{#  layui.each(pagelist, function(index, value){ }}
        <tr>
            <td>{{index+1}}</td>
            <td title="{{value.uploadfilename==null?'':value.uploadfilename}}">{{value.uploadfilename==null?"":value.uploadfilename}}</td>
            <td title="{{value.createtime==null?'':value.createtime}}">{{value.createtime==null?"":value.createtime}}</td>
            <td>
              <!--  <a class="layui-btn layui-btn-normal layui-btn-xs" onclick="previewfile('{{value.downurl_html}}','{{value.uploadfilename}}');">预览</a>-->
                <a class="layui-btn layui-btn-normal layui-btn-xs" onclick="downfile('{{value.recorddownurl}}','{{value.uploadfilename}}');">下载</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" onclick="delPhreport('{{value.ssid}}');">删除</a>
            </td>
        </tr>
        {{#  }); }}
        </tbody>
    </table>

</script>
<script th:src="@{/js/jquery-1.11.1.js}" type="text/javascript"></script>
<script th:src="@{/js/common.js}"  type="text/javascript" ></script>
<script th:src="@{/js/actionid.js}" type="text/javascript"></script>
<script th:src="@{/js/list.js}" type="text/javascript"></script>
<script th:src="@{/js/url.js}" type="text/javascript"></script>
<script th:src="@{/js/wavesurfer.min.js}"></script>
<script th:src="@{/js/echarts.min.js}" type="text/javascript"></script>
<script th:src="@{/layui/layui.js}"type="text/javascript"></script>
<script th:src="@{/layui/lay/modules/laytpl.js}" type="text/javascript"></script>
<script th:src="@{/js/client_web/police/record/getRecordById.js}" type="text/javascript"></script>
<script th:src="@{/js/client_web/police/record/phreportIndex.js}" type="text/javascript"></script>
<script th:src="@{/pdfjs/pdf.js}" type="text/javascript"></script>

<script th:inline="javascript">
    var INIT_CLIENT;
    var INIT_CLIENTKEY;
    var recordssid;
    var togetPolygraphurl;//打开身心检测数据
    var tocaseToUserURL;

    var sessionadminssid=[[${session.MANAGE_CLIENT.ssid}]];
    var gnlist=[[${session.AUTHORIZATIONALL_CLIENT.gnlist}]];
    $(function(){
        INIT_CLIENT=[[${session.INIT_CLIENT}]];
        INIT_CLIENTKEY=[[${session.INIT_CLIENTKEY}]];
        setpageAction(INIT_CLIENT,"client_web/police/record/getRecordById");
        recordssid=[[${getRecordByIdModel.recordssid}]];
        getRecordById();//获取笔录案件等信息

      /*  main1();//身心统计回放*/
        togetPolygraphurl = getActionURL(getactionid_manage().getRecordById_togetPolygraph);
        tocaseToUserURL = getActionURL(getactionid_manage().getRecordById_tocaseToUser);

        $('#recorddetail_webkit, #recorddetail_scrollhtml div:eq(0)').css({'width':($("#recorddetail_scrollhtml").closest(".layui-col-md7").width())});
        $(window).resize(function(){
            $('#recorddetail_webkit, #recorddetail_scrollhtml div:eq(0)').css({'width':($("#recorddetail_scrollhtml").closest(".layui-col-md7").width())});
        })
    });
    layui.use(['layer','element','slider','form','laydate'], function(){
        var layer = layui.layer; //获得layer模块
        var element = layui.element;
        var slider = layui.slider;
        var form = layui.form;
        var laydate = layui.laydate;
        //使用模块

        laydate.render({
            elem: '#starttime'
            ,type: 'datetime'
            ,range: "~"
            ,done: function(value, date, endDate){
                starttime=value;
                getPhreportsByParam();
            }
        });

        form.on('switch(phreportshowhide)', function(data){
            if (!isNotEmpty(dq_play)){
                layer.msg("暂未找到视频，未能出现情绪报告");
                return;
            }
           if (!isNotEmpty(phdatabackList)){
                    layer.msg("暂未找到身心监测数据，未能出现情绪报告");
                    return;
            }
            var bool=data.elem.checked;
            if (bool) {
                //显示checkbox
                $("#phreportshowhidemsg").text("（提示:勾选需要生成的情绪数据)");
                $("#uploadPhreport").css("visibility","visible");
                $("#recordreals #dqphdate").css("display", "block");
                $("#recordreals div").each(function () {
                    var talkclass=$(this).attr("class");
                  if (talkclass=="atalk"){
                        $("p",this).prepend('<input type="checkbox" name="" lay-skin="primary" >');
                    }else if (talkclass=="btalk"){
                      $("#recordreals .layui-badge").css("visibility", "visible");
                        $("p",this).append('<input type="checkbox" name="" lay-skin="primary" >');
                     }
                });
                form.render();
            }else {
                //隐藏并且checkbox
                $("#phreportshowhidemsg").text("（提示:开启可勾选生成情绪报告)");
                $("#uploadPhreport").css("visibility","hidden");
                $("#recordreals .layui-badge").css("visibility", "hidden");
                $("#recordreals #dqphdate").css("display", "none");
                $("#recordreals input[type=checkbox]").remove();
                $("#recordreals .layui-form-checkbox").remove();
            }

        });
    });


</script>
</body>
</html>